---
title: 闭包
date: 2016-05-08 21:52:36
tags: [JavaScript,闭包]
---
### 闭包的概念
有权访问另一个函数作用域中的变量的函数。
### 如何实现闭包
创建闭包最常见的方式是在一个函数内创建另一个函数,通过另一个函数访问这个函数的局部变量,利用闭包可以突破作用域链,将函数内部的变量和方法传递到外部.
<!--more-->
### 闭包的特性
1. 函数内再嵌套函数.
2. 内部函数可以引用外层的参数和变量.
3. 参数和变量不会被垃圾回收机制回收.
*在另一个函数内部定义的函数会将包含函数的活动对象添加到它的作用域链中,因此在函数执行完毕后,其活动对象也不会被销毁,因为其内含函数的作用域链仍然在引用这个活动对象.*


### 闭包的缺点
1. 过度使用闭包会导致内存占用过多
2. 闭包只能取得循环中变量的最后一个值
``` bash
function createFunctions() {
    var result = new Array();
    for (var i = 0; i < 10; i++) {
        result[i] = function () {
            return i;
        };
    }
    return result; //返回的result数组里全部为10
}
```
__每个函数的作用域链中都保存着父函数的活动对象，所以它们引用的都是同一个变量i。__



可以通过创建另一个匿名函数来让闭包的行为符合预期。
``` bash
function createFunctions() {
    var result = new Array();
    for (var i = 0; i < 10; i++) {
        result[i] = function (num) {
            return function () {
                return num; //通过闭包维持住局部变量num的存在
            }
        }(i);
    }
    return result;
}
```